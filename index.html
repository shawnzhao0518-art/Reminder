<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ¯æ—¥æé†’äº‹é¡¹</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    h1 { text-align:center; }
    .cover { text-align:center; margin-bottom:15px; }
    .cover img { width:100%; max-height:200px; object-fit:cover; border-radius:10px; }
    .task { margin:10px 0; display:flex; align-items:center; justify-content:space-between; }
    .task input[type="checkbox"] { margin-right:10px; }
    .container { max-width:420px; margin:0 auto; background:white; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .addTask { display:flex; margin-top:20px; }
    .addTask input { flex:1; padding:6px; }
    .addTask button { padding:6px 12px; margin-left:5px; }
    .removeBtn { margin-left:10px; color:red; cursor:pointer; }
    .progress { margin:15px 0; background:#eee; border-radius:5px; overflow:hidden; height:20px; }
    .progress-bar { height:100%; width:0%; background:#4caf50; text-align:center; color:white; font-size:12px; transition: width 0.3s; }
    .completeMsg { display:none; text-align:center; margin-top:15px; font-size:16px; font-weight:bold; color:#2e7d32; }
    .quote { margin-top:20px; text-align:center; font-size:14px; font-style:italic; color:#555; }
    .coverControls { margin-top:10px; text-align:center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>æ¯æ—¥æé†’äº‹é¡¹</h1>
    
    <!-- å°é¢åŒºåŸŸ -->
    <div class="cover">
      <img id="coverImage" src="" alt="å°é¢">
    </div>
    <div class="coverControls">
      <input type="file" id="coverFile" accept="image/*">
      <button onclick="uploadCover()">é€‰æ‹©å°é¢</button>
    </div>

    <!-- è¿›åº¦æ¡ -->
    <div class="progress"><div class="progress-bar" id="progressBar">0%</div></div>
    
    <!-- ä»»åŠ¡æ¸…å• -->
    <div id="taskList"></div>
    
    <!-- æ·»åŠ ä»»åŠ¡ -->
    <div class="addTask">
      <input id="newTaskInput" type="text" placeholder="è¾“å…¥æ–°ä»»åŠ¡..." />
      <button onclick="addTask()">æ·»åŠ </button>
    </div>
    
    <!-- å®Œæˆæç¤º -->
    <div class="completeMsg" id="completeMsg">ğŸ‰ ä»Šæ—¥ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼</div>
    
    <!-- æ¯æ—¥å¯„è¯­ -->
    <div class="quote" id="dailyQuote"></div>
  </div>

  <script>
    const taskList = document.getElementById("taskList");
    const progressBar = document.getElementById("progressBar");
    const completeMsg = document.getElementById("completeMsg");
    const dailyQuote = document.getElementById("dailyQuote");
    const coverImage = document.getElementById("coverImage");

    let savedData = JSON.parse(localStorage.getItem("dailyTasks")) || { tasks: [], checked: {} };
    const lastReset = localStorage.getItem("lastResetDate");
    const today = new Date().toDateString();

    // åŠ±å¿—è¯­å¥åº“
    const quotes = [
      "åšæŒå°±æ˜¯èƒœåˆ©ï¼", "æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„å¼€å§‹ã€‚", "å°å°çš„è¿›æ­¥ä¹Ÿæ˜¯è¿›æ­¥ã€‚",
      "ä»Šå¤©çš„åŠªåŠ›ä¼šæ¢æ¥æ˜å¤©çš„æˆå°±ã€‚", "ä¿æŒå¾®ç¬‘ï¼Œç»§ç»­å‰è¿›ã€‚",
      "ä½ æ¯”è‡ªå·±æƒ³è±¡çš„æ›´å¼ºå¤§ã€‚", "å¤±è´¥åªæ˜¯æˆåŠŸçš„å«è„šçŸ³ã€‚",
      "ç›¸ä¿¡è‡ªå·±ï¼Œä½ èƒ½åšåˆ°ï¼", "æˆåŠŸæ¥è‡ªäºæ¯æ—¥çš„åšæŒã€‚", "æœªæ¥å±äºåŠªåŠ›çš„äººã€‚"
    ];

    // æ—¥æœŸæ£€æŸ¥ï¼šæ–°çš„ä¸€å¤© -> é‡ç½®ä»»åŠ¡ & éšæœºè¯­å¥
    if (lastReset !== today) {
      savedData.checked = {};
      localStorage.setItem("lastResetDate", today);
      localStorage.setItem("dailyTasks", JSON.stringify(savedData));
      const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
      localStorage.setItem("dailyQuote", randomQuote);
    }

    // æ˜¾ç¤ºæ¯æ—¥è¯­å¥
    const quoteOfTheDay = localStorage.getItem("dailyQuote") || quotes[0];
    dailyQuote.textContent = "ğŸ’¡ ä»Šæ—¥å¯„è¯­ï¼š" + quoteOfTheDay;

    // æ›´æ–°è¿›åº¦
    function updateProgress() {
      const total = savedData.tasks.length;
      const done = savedData.tasks.filter(t => savedData.checked[t]).length;
      const percent = total === 0 ? 0 : Math.round((done / total) * 100);
      progressBar.style.width = percent + "%";
      progressBar.textContent = percent + "%";

      if (total > 0 && done === total) {
        completeMsg.style.display = "block";
      } else {
        completeMsg.style.display = "none";
      }
    }

    // æ¸²æŸ“ä»»åŠ¡
    function renderTasks() {
      taskList.innerHTML = "";
      savedData.tasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "task";
        const left = document.createElement("div");
        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = savedData.checked[task] || false;
        input.addEventListener("change", () => {
          savedData.checked[task] = input.checked;
          saveData();
          updateProgress();
        });
        left.appendChild(input);
        left.appendChild(document.createTextNode(task));
        div.appendChild(left);

        const remove = document.createElement("span");
        remove.className = "removeBtn";
        remove.textContent = "âœ•";
        remove.onclick = () => {
          savedData.tasks = savedData.tasks.filter(t => t !== task);
          delete savedData.checked[task];
          saveData();
          renderTasks();
          updateProgress();
        };
        div.appendChild(remove);

        taskList.appendChild(div);
      });
      updateProgress();
    }

    // æ·»åŠ ä»»åŠ¡
    function addTask() {
      const input = document.getElementById("newTaskInput");
      const task = input.value.trim();
      if (task && !savedData.tasks.includes(task)) {
        savedData.tasks.push(task);
        saveData();
        renderTasks();
      }
      input.value = "";
    }

    // ä¿å­˜æ•°æ®
    function saveData() {
      localStorage.setItem("dailyTasks", JSON.stringify(savedData));
    }

    // ========== å°é¢åŠŸèƒ½ ==========
    // é¡µé¢åŠ è½½æ—¶è½½å…¥å°é¢
    const savedCover = localStorage.getItem("coverImage");
    if (savedCover) {
      coverImage.src = savedCover;
    } else {
      coverImage.src = "https://via.placeholder.com/400x200.png?text=æé†’äº‹é¡¹å°é¢";
    }

    // ä¸Šä¼ å°é¢
    function uploadCover() {
      const fileInput = document.getElementById("coverFile");
      const file = fileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const dataUrl = e.target.result;
          coverImage.src = dataUrl;
          localStorage.setItem("coverImage", dataUrl);
        };
        reader.readAsDataURL(file);
      }
    }

    // åˆå§‹åŒ–æ¸²æŸ“
    renderTasks();
  </script>
</body>
</html>
